<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link type="text/css" href="css/ui-lightness/jquery-ui-1.9.2.custom.min.css" rel="Stylesheet" />
         <style>
             .selectable .ui-selecting {
             background: #ccc;
             }
             .selectable .ui-selected {
             background: #999;
         }
         .entry {
             width:300px;
            }


         </style>
        <script src="js/jquery.min.js"></script>
        <script src="js/jquery-ui.min.js"></script>
        <script type="text/javascript">
            // should IDs be programatically generated greg, seems like it would be safer and less hassle
            // in the long wrong
            // but what if using ids in saving/sharing lists? Can't have them changing!
            var forces = [
                {
                    "id":1,
                    "name":"Panzer Division Battlegroup",
                    "sections":[
                        {
                            "id":1, 
                            "name":"Forward Headquarters Units",
                            "allows":[8,10],
                            "requires":false,
                            "entries":[
                            {
                                "id":1,
                                "name":"Forward Headquarters",
                                "cost":24,
                                "br":3,
                                "options":[
                                    {
                                        "name":"Transport",
                                        "choices":[
                                            {"id":1,"text":"SdKfz 251/3","cost":0},
                                            {"id":2,"text":"SdKfz 251/6","cost":0},
                                            {"id":3,"text":"Panzer II/F","cost":0},
                                            {"id":4,"text":"Panzer III/J","cost":6},
                                            {"id":5,"text":"Panzer IV/G","cost":26},
                                            {"id":6,"text":"Panzer IV/H","cost":32},
                                            {"id":7,"text":"Tiger","cost":61},
                                        ]
                                    }
                                    
                                 ]

                            },
                            {
                                "id":2,
                                "name":"Luftwaffe Air Control Officer",
                                "cost":26,
                                "br":1,
                                "options":[
                                    {
                                        "name":"Transport",
                                        "choices":[
                                            {"id":1,"text":"Kübelwagon","cost":0},
                                            {"id":2,"text":"Medium Truck","cost":2},
                                            {"id":3,"text":"SdKfz 250/3","cost":12},
                                            {"id":4,"text":"SdKfz 251/3","cost":12},
                                        ]
                                    }
                                    
                                 ]

                            },
                            {
                                "id":3,
                                "name":"Forward Signals Unit",
                                "br":1,
                                "cost":18,
                                "options":[
                                    {
                                        "name":"Transport",
                                        "choices":[
                                            {"id":1,"text":"Medium Radio Truck","cost":0},
                                            {"id":2,"text":"SdKfz 251/3 Radio Half Track","cost":6},
                                            {"id":3,"text":"SdKfz 250/3 Radio Half Track","cost":6},
                                            {"id":4,"text":"SdKfz 236","cost":6},
                                            {"id":5,"text":"SdKfz 223","cost":6},
                                            {"id":6,"text":"Panzer III M","cost":42, "br":2},
                                            {"id":7,"text":"Panzer IV H","cost":50, "br":2},
                                        ]
                                    }
                                    
                                 ]

                            },
                            {
                                "id":4,
                                "name":"Comms Relay Team",
                                "br":0,
                                "cost":14,
                                "options":[
                                    {
                                        "name":"Transport",
                                        "choices":[
                                            {"id":1,"text":"Kübelwagon","cost":0},
                                            {"id":2,"text":"Medium Truck","cost":2},
                                            {"id":3,"text":"SdKfz 250/3","cost":12},
                                            {"id":4,"text":"SdKfz 251/3","cost":12},
                                        ]
                                    }
                                    
                                 ]

                            }
                            ]

                        },
                    /*
                        {
                            "id":2, 
                            "name":"Infantry Units",
                            "allows":[6,7,8],
                            "requires":false,
                        },
                        {
                            "id":3, 
                            "name":"Tank Units",
                            "allows":[6,7,8],
                            "requires":false,
                        },
                        {
                            "id":4, 
                            "name":"Artillery Units",
                            "allows":[6,7,8],
                            "requires":false,
                        },
                        {
                            "id":5, 
                            "name":"Defences",
                            "allows":null,
                            "requires":false,
                            },
                            */
                    {
                        "id":6, 
                        "name":"Reconnaissance Support Units",
                        "allows":null,
                        "requires":true,
                        "entries":[
                            {
                                "id":1,
                                "name":"Sniper",
                                "cost":10,
                                "br":1,
                                "options":[
                                    {
                                        "name":"Unit Composition",
                                        "choices":[
                                            {"id":1,"text":"1 man","cost":0},
                                            {"id":2,"text":"+Spotter","cost":5},
                                        ]
                                    }
                                ]

                            },
                        ],
                    },
                    ],
                },
                {
                    "id":2,
                    "name":"Second Battlegroup",
                },
                ];

// maybe make it get which value from a select?
function render_name(force) {
    return("<p>"+force['name']+"</p>");
}
function render_sections(force) {
    var text="";
    for(var i = 0; i < force['sections'].length; i++) {
        if (force.sections[i].requires)
            text = text + "<div allows='"+ force['sections'][i].allows +"' class=' section ui-widget ui-state-disabled' id=" + force.id + "_" + force['sections'][i].id + ">";
        else
            text = text + "<div allows='"+ force['sections'][i].allows +"' class=' section ui-widget selectable' id=" + force.id + "_" + force['sections'][i].id + ">";
        text = text+render_entries(force['sections'][i]);
        text = text + "</div>";
    }
    return text;
//        for(key in force['sections'])
}

function render_entries(section) {
    var text="";
    for(var i = 0; i < section['entries'].length; i++) {
        text = text + "<div class='entry ui-widget-content' id='greg_" + section['entries'][i].id+"'>";
        text = text + "<p>"+section['entries'][i].name+"</p>";
        for(var j = 0; j < section['entries'][i]['options'].length; j++) {
            text = text + '<select name="' + section['entries'][i]['options'][j]['name']+'">';
            for (var k=0; k<section.entries[i].options[j].choices.length; k++) {
                text = text + "<option cost='"+section.entries[i].options[j].choices[k].cost+"' value='" + section.entries[i].options[j].choices[k].id +"'>"+section.entries[i].options[j].choices[k].text + "</option>"; 
            }
            text = text + "</select>";
        }



        text = text + "</div>"
    }
    return text;
}

function render_force(which) {
    var text="";
    var force = forces[which];
    text = render_name(force);
    text = text + render_sections(force);
    for(key in force) {
        text = text+key;
    }
    $('#main').html(text);

}

function render() {
    render_force(0);
}

function unselecting(event, ui){
    //ui.unselecting.addClass('ui-selected');
    // can prevent un-selecting here if desired
    if ( false )
        $(ui.unselecting).addClass('ui-selected');
}
function unselected(event, ui){
    // can print allows attribute with following
    // alert($(ui.unselected).parent().attr('allows'));
    // Decide if we need to disable any segments
    // actually no good get currently disabled allows, we need to get all currently selected allows and compare versus currently selected requires perhaps?
}

function update_dynamic(){
    $( ".selectable" ).bind("mousedown", function(e) {
            e.metaKey = true;
            }).selectable({ filter: 'div', unselecting:unselecting, unselected:unselected });
}

    $( document ).ready( function() {
            render();
            update_dynamic();
        });
// greg http://stackoverflow.com/questions/4492987/programmatically-unselect-a-jquery-ui-selectable-widget
        </script>
    </head>
    <body><h1>It works!</h1>
<p>This is the default web page for this server.</p>
<p>The web server software is running but no content has been added, yet.</p>
<div id="main" style="width:100%; clear:both;" class="ui-widget">abc</div>


</body></html>

